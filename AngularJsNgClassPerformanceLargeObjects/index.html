<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.19f8432c13000cf72486.css">html{--text-color:#000;--background-color:#fff;--light-background-color:#e8ebfd;--primary-color:#006;--primary-light-color:#66a;--secondary-color:#060;--secondary-light-color:#6a6;--warning-color:#a66;--title-color:#000;--link-color:var(--primary-color);--visited-color:var(--primary-light-color)}@media (prefers-color-scheme:dark){html{--text-color:hsla(0,0%,100%,0.5);--background-color:#000;--light-background-color:#0e1831;--title-color:#88f;--primary-color:rgba(128,128,255,0.9);--primary-light-color:rgba(116,116,200,0.7);--secondary-color:#0a0;--secondary-light-color:#383;--warning-color:#a22}}.table-responsive{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}table{border-spacing:0;border-collapse:separate}th{color:#fff;background:var(--primary-light-color);padding:.5em 1em}table,td,th{border:.1rem solid var(--primary-light-color)}td{padding:.3em .6em;font-size:90%}center{display:block;margin:0 auto}body,html{font-size:1.1rem;margin:0;font-family:Avenir,Montserrat,Helvetica Neue,Helvetica,Verdana,sans-serif;line-height:1.5;background:var(--background-color);color:var(--text-color)}a{color:var(--primary-color)}a:visited{color:var(--primary-light-color)}img{max-width:100%}@media (prefers-color-scheme:dark){img{opacity:.7}}img.left{float:left;padding-top:.5em;padding-right:1em;padding-bottom:.7em}h1,h2,h3,h4{color:var(--title-color);margin-top:3em;margin-bottom:1rem;line-height:1.35}h1{font-weight:900;font-size:4rem;line-height:4rem;margin-top:5rem}h2{border-bottom:.12rem solid var(--title-color)}blockquote{color:grey;font-family:Times New Roman;font-size:1.5rem}.gatsby-highlight{font-size:.7em;margin:16px 0}:not(pre)>code[class*=language-]{font-size:.7rem}.small{font-size:70%}input{width:100%}button,input{border:5px solid var(--text-color);font-size:inherit;font-family:inherit;color:inherit;background:inherit}button{margin-top:10px}.error{color:red}input{display:inline;width:auto;height:1.4em}code[class*=language-],pre[class*=language-]{color:var(--text-color);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:var(--visited-color)}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:var(--visited-color)}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:var(--light-background-color)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:var(--secondary-light-color)}.token.punctuation{color:var(--text-color)}.namespace{opacity:.5}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:var(--secondary-color)}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:var(--warning-color)}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:var(--link-color)}.token.class-name,.token.function{color:var(--visited-color)}.token.class-name{text-decoration:underline}.token.important,.token.regex,.token.variable{color:var(--warning-color)}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.18.18"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Angular1 Performance: ngClass and large objects — @drpicox</title><meta data-react-helmet="true" charSet="utf-8"/><link rel="icon" href="/icons/icon-48x48.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#ff6699"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=0136c995f8f2d895c63757ea89fbd7af"/><link as="script" rel="preload" href="/webpack-runtime-1521b60311164167c383.js"/><link as="script" rel="preload" href="/styles-b06f65a10670feeb2a17.js"/><link as="script" rel="preload" href="/app-21dd1ea63a06020918b0.js"/><link as="script" rel="preload" href="/commons-11945abf3215f370db4b.js"/><link as="script" rel="preload" href="/component---wiki-angular-js-ng-class-performance-large-objects-mdx-e0feddedec2ade1f8ee2.js"/><link as="fetch" rel="preload" href="/page-data/AngularJsNgClassPerformanceLargeObjects/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="1mvq04f">.css-1mvq04f{grid-area:header;padding:1rem 0;margin-bottom:3rem;}</style><div class="css-1mvq04f"><style data-emotion-css="10pdcx9">.css-10pdcx9{margin:0 auto;max-width:37rem;padding:0 0.5rem;}</style><div class="css-10pdcx9"><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs"><style data-emotion-css="2sau16">.css-2sau16{width:5rem;}@media (max-width:35rem){.css-2sau16{width:0em;}}</style><span class="css-2sau16"></span><style data-emotion-css="t75dgm">.css-t75dgm{border-radius:100em;height:4.25em;width:4.25em;}</style><div class="css-t75dgm gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:100.46511627906978%"></div><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAL/xAAXAQADAQAAAAAAAAAAAAAAAAABAgMA/9oADAMBAAIQAxAAAAGqhYtNTIwzwWn2GH//xAAbEAADAAIDAAAAAAAAAAAAAAAAAQIQERIiMf/aAAgBAQABBQK6O8HJDnQvJnaYqeP/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPwEj/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BIf/EABsQAAIBBQAAAAAAAAAAAAAAAAERAAIQICEx/9oACAEBAAY/AlToxksX5j//xAAdEAEAAgICAwAAAAAAAAAAAAABACFBURARMWGB/9oACAEBAAE/IewLjLiH3sT0sDzzBbaWXA9DUF3P/9oADAMBAAIAAwAAABBHwP3/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EAJba8//xAAXEQEBAQEAAAAAAAAAAAAAAAAAIQER/9oACAECAQE/EEZiRx//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAxIVHBcZH/2gAIAQEAAT8QfcSpaHWI5gQVvHmEPLGKF0BZlFSRUu5jNbvvOBx+5YkW4YIgj45//9k=" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/c79a039e4a9310f0a85d5f9a5a896294/c6f75/david.jpg 75w,
/static/c79a039e4a9310f0a85d5f9a5a896294/421ae/david.jpg 150w,
/static/c79a039e4a9310f0a85d5f9a5a896294/f5c8e/david.jpg 215w" sizes="(max-width: 215px) 100vw, 215px" /><img loading="lazy" sizes="(max-width: 215px) 100vw, 215px" srcset="/static/c79a039e4a9310f0a85d5f9a5a896294/c6f75/david.jpg 75w,
/static/c79a039e4a9310f0a85d5f9a5a896294/421ae/david.jpg 150w,
/static/c79a039e4a9310f0a85d5f9a5a896294/f5c8e/david.jpg 215w" src="/static/c79a039e4a9310f0a85d5f9a5a896294/f5c8e/david.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><style data-emotion-css="1buzfhb">.css-1buzfhb{width:1em;}</style><span class="css-1buzfhb"></span><div><div class="css-k008qs"><style data-emotion-css="1dsl6o8">.css-1dsl6o8{font-size:2rem;font-weight:bolder;-webkit-text-decoration:none;text-decoration:none;}.css-1dsl6o8:visited{color:inherit;color:var(--link-color);}</style><a class="css-1dsl6o8" href="/">@drpicox</a></div><div><style data-emotion-css="1k0xh6m">.css-1k0xh6m{padding-right:0.5rem;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1k0xh6m:visited{color:inherit;}.css-1k0xh6m:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-1k0xh6m[aria-current]{color:gray;-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1k0xh6m" href="/Home">HOME</a><a class="css-1k0xh6m" href="/Blog">BLOG</a><a class="css-1k0xh6m" href="/Testing">TEST<style data-emotion-css="1e63vo2">@media (max-width:30rem){.css-1e63vo2{display:none;}}</style><span class="css-1e63vo2">ING</span></a><a class="css-1k0xh6m" href="/Teaching">TEACH<span class="css-1e63vo2">ING</span></a></div></div></div></div></div><style data-emotion-css="n7iznt">.css-n7iznt{grid-area:main;}</style><div class="css-n7iznt"><style data-emotion-css="10pdcx9">.css-10pdcx9{margin:0 auto;max-width:37rem;padding:0 0.5rem;}</style><div class="css-10pdcx9"><h1>Angular1 Performance: ngClass and large objects</h1><p>Some times the performance of Angular1 applications
suddenly drops.
Many times it is due to ngClass,
or while using scope: &#x27;=&#x27; in our directives.
Here I present a simple optimization
that ensures the best performance.</p><div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ng-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{friendly: user.friends, male: user.isMale}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ng-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{friendly: !!user.friends, male: user.isMale}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span></code></pre></div><h2>What is $watch?</h2><p>Angular updates views by observing models and expressions
through <em>$watch</em>:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">$scope<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>whatToWatch<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// react to the change</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> objectEquality<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>$watch parameters are the followings:</p><ul><li><strong>whatToWatch</strong>: $watch will track changes in this expression,</li><li><strong>onChange</strong>: angular execute this function each time that the value changes,</li><li><strong>objectEquality</strong>: it describes which change will trigger onChange. </li></ul><p><em>ObjectEquality</em> holds the performance key.
It only has two valid values: <em>true</em> or <em>false</em>.</p><h3>$watch(expr, onChange, false)</h3><p>The algorithm is the following:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> oldValue<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">onDigest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> newValue <span class="token operator">=</span> expr<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">!==</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// compare new and old</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldValue <span class="token operator">=</span> newValue<span class="token punctuation">;</span>          <span class="token comment">// save new value</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>It is the fastest $watch.
It is because the comparison
(compare new and old) is the not-equal operator,
and copy (save new value) is an assignation.</p><p>But it have a risk: if the value is an object or an array
it calls onChange only when the object or array is replaced.
It ignores changes in fields or element changes.</p><h3>$watch(expr, onChange, true)</h3><p>The algorithm is the following: </p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> oldValue<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">onDigest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> newValue <span class="token operator">=</span> expr<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>angular<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// compare new and old</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldValue <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// save new value</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>It is the slowest $watch.
It uses <em>angular.equals</em> for the comparison,
and <em>angular.copy</em> to save the value.
But it detects all changes,
including changes in object fields or array elements.</p><h2>Complex objects and $watch...true</h2><p>Let&#x27;s imagine an object as the following:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> david <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;David Rodenas&#x27;</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">[</span>jairo<span class="token punctuation">,</span> janton<span class="token punctuation">,</span> moraleda<span class="token punctuation">,</span> natalia<span class="token punctuation">,</span> sarek<span class="token punctuation">,</span> victor<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>This object contains friends field.
This field is an array that contains other users.
Each user may have potentially other friends.</p><h3>Six degrees of separation</h3><p><a href="https://en.wikipedia.org/wiki/Six_degrees_of_separation" target="_blank" rel="nofollow noopener noreferrer">Six degrees of separation</a>
theory tell us that we can reach all our users just following friends relationships.</p><div class="gatsby-highlight" data-language="nomnoml"><pre class="language-nomnoml"><code class="language-nomnoml">#direction: right

[&lt;actor&gt;you]
[you] - [&lt;actor&gt;friend1]
[you] - [&lt;actor&gt;friend2]
[you] - [&lt;actor&gt;friend ...]
[you] - [&lt;actor&gt;friend4]
[friend2] - [&lt;actor&gt;friendof1]
[friend2] - [&lt;actor&gt;friendof2]
[friend2] - [&lt;actor&gt;fof ...]
[friend2] - [&lt;actor&gt;friendofn]
[friendofn] - [&lt;actor&gt;friendofof1]
[friendofn] - [&lt;actor&gt;friendofof2]
[friendofn] - [&lt;actor&gt;fofof...]
[friendofn] - [&lt;actor&gt;friendofofn]
[friendofof1] - [&lt;actor&gt;friendofofof1]
[friendofof1] - [&lt;actor&gt;friendofofof2]
[friendofof1] - [&lt;actor&gt;fofofof ...]
[friendofof1] - [&lt;actor&gt;friendofofofn]</code></pre></div><h3>Complex object copy</h3><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> oldDavid <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>david<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>It creates <em>oldDavid</em> which is a copy of <em>david</em>
but also a copy of each of its friends,
friends of friends, and all users in our domain. </p><p>Thus, this copy is very expensive operation.</p><h3>Complex object equals</h3><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> hasChanges <span class="token operator">=</span> <span class="token operator">!</span>angular<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>david<span class="token punctuation">,</span> oldDavid<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>It compares each property of both, <em>oldDavid</em> and <em>david</em>.
If a property is an array, it compares each element.
If elements are an object it compares once again value by value.
And so on.
It eventually will check that each user in our domain
has the same name and friends.</p><p>This, this equals operations is very expensive.</p><h3>Other complex objects</h3><p>There are lots of other objects that are complex. </p><p>Library example:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> davidUser <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;David Rodenas&#x27;</span><span class="token punctuation">,</span>
  loans<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>book<span class="token operator">:</span> theGoodParts<span class="token punctuation">,</span> expires<span class="token operator">:</span> <span class="token string">&#x27;2016/11/12&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>book<span class="token operator">:</span> aDeepnessInTheSky<span class="token punctuation">,</span> expires<span class="token operator">:</span> <span class="token string">&#x27;2016/10/21&#x27;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cleanCodeBook <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;Clean Code&#x27;</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> <span class="token string">&#x27;Robert Cecil Martin&#x27;</span><span class="token punctuation">,</span>
  history<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> oriol<span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2015/06/08&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> lluis<span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2015/09/24&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> david<span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2016/02/12&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> granados<span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2016/04/01&#x27;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Here are not friends, but a user has books, books has more users, etc.
It will potentially copy all objects in our domain.</p><h2>Ids instead of references</h2><p>Replacing object references by ids
can make objects less complex.</p><h3>Friends example</h3><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> david <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&#x27;#david&#x27;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;David Rodenas&#x27;</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;#jairo&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#janton&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#moraleda&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#natalia&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#sarek&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#victor&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><h3>Library example</h3><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> davidUser <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&#x27;#david&#x27;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;David Rodenas&#x27;</span><span class="token punctuation">,</span>
  loans<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>book<span class="token operator">:</span> <span class="token string">&#x27;#theGoodParts&#x27;</span><span class="token punctuation">,</span> expires<span class="token operator">:</span> <span class="token string">&#x27;2016/11/12&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>book<span class="token operator">:</span> <span class="token string">&#x27;#aDeepnessInTheSky&#x27;</span><span class="token punctuation">,</span> expires<span class="token operator">:</span> <span class="token string">&#x27;2016/10/21&#x27;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cleanCodeBook <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&#x27;#cleanCode&#x27;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;Clean Code&#x27;</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> <span class="token string">&#x27;Robert Cecil Martin&#x27;</span><span class="token punctuation">,</span>
  history<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> <span class="token string">&#x27;#oriol&#x27;</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2015/06/08&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> <span class="token string">&#x27;#lluis&#x27;</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2015/09/24&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> <span class="token string">&#x27;#david&#x27;</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2016/02/12&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>user<span class="token operator">:</span> <span class="token string">&#x27;#granados&#x27;</span><span class="token punctuation">,</span> date<span class="token operator">:</span> <span class="token string">&#x27;2016/04/01&#x27;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><h3>Copy and equals</h3><p>There are no direct references to other objects when using ids.</p><p>Given friends example, <em>angular.copy</em> create another object, with
fields <em>id</em>, <em>name</em> with the same value, and a field <em>friends</em>
with a copy of the array with the same values.</p><p><em>angular.equals</em> check that both objects have the same fields,
<em>id</em> and <em>name</em> has the same values, and field <em>friends</em>
has the same values in the same order in both objects.</p><h2>Accelerate ngClass</h2><p>ngClass uses <em>$watch-true</em>.
It needs to track changes inside an object.</p><h3>Problem</h3><p>Given the example:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> ng<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;{friendly: user.friends}&quot;</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span></code></pre></div><p>ngClass watches the expression:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  <span class="token punctuation">{</span>friendly<span class="token operator">:</span> user<span class="token punctuation">.</span>friends<span class="token punctuation">}</span></code></pre></div><p>It copies and compares all user friends,
friend of friends, ... which is really expensive.</p><h3>What we want</h3><p>What we really meant to write was:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> ng<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;{friendly: user.hasFriends()}&quot;</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span></code></pre></div><p>In such case <em>ngClass</em> would see one of the two following values:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> caseAddClass <span class="token operator">=</span> <span class="token punctuation">{</span>friendly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> caseRemoveClass <span class="token operator">=</span> <span class="token punctuation">{</span>friendly<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>There is no trace of the user object.
It will not copy neither compare user values, friends, ...
No need to replace references by ids.</p><h3>Double negation notation</h3><p>It is not always feasible to add new methods or properties
like <em>user.hasFriends</em>.</p><p>In such cases we can use double negation <code class="language-text">!!</code> to a
<em>truthy</em>/<em>falsy</em> value into a <em>true</em>/<em>false</em>.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> ng<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;{friendly: !!user.friends}&quot;</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span></code></pre></div><p><em>ngClass</em> see one of the following values:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> caseAddClass <span class="token operator">=</span> <span class="token punctuation">{</span>friendly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> caseRemoveClass <span class="token operator">=</span> <span class="token punctuation">{</span>friendly<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Thus, no complex object copy or comparison.</p><h2>Comparison</h2><h3>Implementation oportunity</h3><p>Use ids instead of references is not always possible.
There are cases where an object will contain its own entities.
For example: a todo list may contain its todo objects.</p><p>Double negation notation is always possible to use.</p><h3>Implementation cost</h3><p>Using ids instead of references ensures that
$watch will never do a large copy or comparison.
But it may need a deep refactor of the application.
It makes it one of the most difficult possible solutions.</p><p>Double negation notation is simple,
just look for ngClass directives and add a double
negation operator before each object.</p><h3>Programmer reliability</h3><p>Using ids instead of references will always work.
Programmer has to do nothing but use it.
It ensures that in any case accidentally the programmer
will make $watch to copy and compare all domain objects. </p><p>Using double negation notation is dangerous.
A programmer may forget use it inside a ngClass,
work well the first day, and later, some day
discover that the app starts to behave sluggish.</p><h3>Performance</h3><table><thead><tr><th></th><th align="right">Digest-loop time</th></tr></thead><tbody><tr><td>No double negation</td><td align="right">1.40ms</td></tr><tr><td>With double negation</td><td align="right">0.02ms</td></tr></tbody></table><p>Time without double negation varies:
how big is the basic object?
how many references it has?
how many references have your domain?
In some cases I have seen it take more
than 30 seconds.</p><p>Double negation notation execution time is constant.
It does not matter how big the object is,
how complex is our domain, it always will
take the same time.</p><h2>Conclusion</h2><p>It is not always possible use ids instead of references.
But even using ids instead of references it copies
the object and compares it.
If the object is complex the performance will suffer.
It does not give any guarantee of good performance. </p><p>Double negation notation is simple,
always have a predictable behaviour and good performance.
The only problem is the programmer,
he may omit some double negation and performance will
suffer.
But it has a simple solution:
time to time, or if performance degrades,
look for all ngClass and check double negations,
if any is missing, just add it.</p><h2>Replicate benchmarks</h2><p>Performance times are obtained using benchpress.</p><p>You can replicate the experiments with
the benchpress benchmark inside AngularJS git repo
<a href="https://github.com/drpicox/angular.js/tree/11d94ab6531c9aca6383f6eb8f23d182ea003d75/benchmarks" target="_blank" rel="nofollow noopener noreferrer">ng-class-bp</a> . </p><h2>More information</h2><p>You can consult the official documentation <a href="https://docs.angularjs.org/guide/production#disable-comment-and-css-class-directives" target="_blank" rel="nofollow noopener noreferrer">here</a>
to learn more details.</p><ul><li>$compile: <a href="https://docs.angularjs.org/api/ng/service/$compile" target="_blank" rel="nofollow noopener noreferrer">https://docs.angularjs.org/api/ng/service/$compile</a></li><li>$watch: <a href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$watch" target="_blank" rel="nofollow noopener noreferrer">https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$watch</a></li></ul></div></div><style data-emotion-css="10pdcx9">.css-10pdcx9{margin:0 auto;max-width:37rem;padding:0 0.5rem;}</style><div class="css-10pdcx9"><style data-emotion-css="10sy1bi">.css-10sy1bi{grid-area:header;padding:1em 0;color:gray;font-size:0.8em;margin-top:3em;}.css-10sy1bi a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-10sy1bi"><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs">Copyright © <!-- -->2020<!-- --> David Rodenas<style data-emotion-css="1rr4qq7">.css-1rr4qq7{-webkit-flex:1;-ms-flex:1;flex:1;}</style><div class="css-1rr4qq7"></div><a href="https://github.com/drpicox" target="_blank" rel="nofollow noopener noreferrer">G</a> · <a href="https://twitter.com/drpicox" target="_blank" rel="nofollow noopener noreferrer">T</a> · <a href="https://medium.com/@drpicox" target="_blank" rel="nofollow noopener noreferrer">M</a> <style data-emotion-css="1rf0dhi">.css-1rf0dhi{position:fixed;bottom:0.5em;right:0.5em;}</style><a href="https://github.com/drpicox/david-rodenas.com/edit/masterundefined" target="_blank" rel="nofollow noopener noreferrer" class="css-1rf0dhi">π</a></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-41300908-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/AngularJsNgClassPerformanceLargeObjects/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-21dd1ea63a06020918b0.js"],"component---blog-2018-09-29-october-1st-catalonia-freedom-referendum-mdx":["/component---blog-2018-09-29-october-1st-catalonia-freedom-referendum-mdx-5272171909417e4aa17c.js"],"component---blog-2019-10-12-welcome-again-mdx":["/component---blog-2019-10-12-welcome-again-mdx-142887dd9bce7ec6690d.js"],"component---blog-2018-06-29-the-myth-of-100-of-code-coverage-mdx":["/component---blog-2018-06-29-the-myth-of-100-of-code-coverage-mdx-835ce824afdce2fdff2c.js"],"component---blog-2020-01-12-the-unit-test-trap-mdx":["/component---blog-2020-01-12-the-unit-test-trap-mdx-3fd311b9d882bbd5e224.js"],"component---blog-2019-04-26-a-quick-puzzle-to-understand-the-testing-and-the-refactoring-mdx":["/component---blog-2019-04-26-a-quick-puzzle-to-understand-the-testing-and-the-refactoring-mdx-02716e43e4062243540a.js"],"component---blog-2020-01-21-unit-vs-programmer-vs-integration-test-mdx":["/component---blog-2020-01-21-unit-vs-programmer-vs-integration-test-mdx-502cf63484252982ea3b.js"],"component---blog-2020-03-05-redux-and-domain-driven-development-mdx":["/component---blog-2020-03-05-redux-and-domain-driven-development-mdx-4670ebe61e768bf44cc3.js"],"component---blog-2020-03-06-everyone-knows-how-to-do-great-testing-mdx":["/component---blog-2020-03-06-everyone-knows-how-to-do-great-testing-mdx-698b77af628911091eee.js"],"component---blog-2018-02-09-why-you-should-start-writing-tests-as-they-were-documentation-mdx":["/component---blog-2018-02-09-why-you-should-start-writing-tests-as-they-were-documentation-mdx-13813b3939a1c1e51910.js"],"component---blog-2019-02-22-the-view-is-not-a-function-mdx":["/component---blog-2019-02-22-the-view-is-not-a-function-mdx-86eb4ab87b063f047822.js"],"component---blog-2019-02-07-the-view-is-a-function-mdx":["/component---blog-2019-02-07-the-view-is-a-function-mdx-2d32c334694b2e92cf86.js"],"component---wiki-angular-js-components-typescript-mdx":["/component---wiki-angular-js-components-typescript-mdx-b18d831c246a18394f7c.js"],"component---wiki-angular-js-ng-class-performance-mdx":["/component---wiki-angular-js-ng-class-performance-mdx-1f957fbd70c681940824.js"],"component---wiki-angular-js-designers-mdx":["/component---wiki-angular-js-designers-mdx-97a5fd47978a924bab80.js"],"component---wiki-angular-js-shopping-cart-demo-mdx":["/component---wiki-angular-js-shopping-cart-demo-mdx-aa17770094d25fe007a6.js"],"component---wiki-blog-mdx":["/component---wiki-blog-mdx-e9bae9c4900d4f2a049d.js"],"component---wiki-angular-js-ng-class-performance-large-objects-mdx":["/component---wiki-angular-js-ng-class-performance-large-objects-mdx-e0feddedec2ade1f8ee2.js"],"component---wiki-browserify-envify-mdx":["/component---wiki-browserify-envify-mdx-6fb081ee91f3173e6a38.js"],"component---wiki-classic-games-mdx":["/component---wiki-classic-games-mdx-7d758e8c92376c6416dd.js"],"component---wiki-defensive-programming-mdx":["/component---wiki-defensive-programming-mdx-6188514a7b619283642b.js"],"component---wiki-home-mdx":["/component---wiki-home-mdx-7219177c8c91e8424c0b.js"],"component---wiki-java-enum-mdx":["/component---wiki-java-enum-mdx-277bed3e87d7c0e78c08.js"],"component---wiki-must-read-mdx":["/component---wiki-must-read-mdx-22b251172d65a5979813.js"],"component---wiki-must-read-web-mdx":["/component---wiki-must-read-web-mdx-95e546aef8f59efaf80c.js"],"component---wiki-bowling-game-kata-mdx":["/component---wiki-bowling-game-kata-mdx-68a69b5496821165e9de.js"],"component---wiki-notes-mdx":["/component---wiki-notes-mdx-b29a002078ec29f97c47.js"],"component---wiki-npm-offline-mdx":["/component---wiki-npm-offline-mdx-45c4ca62794dd0eb4a81.js"],"component---wiki-raft-implementation-mdx":["/component---wiki-raft-implementation-mdx-5cfb26869c297aeaefec.js"],"component---wiki-spring-mock-dice-mdx":["/component---wiki-spring-mock-dice-mdx-f6868e4fb9c954471407.js"],"component---wiki-spring-mocks-mdx":["/component---wiki-spring-mocks-mdx-fa5d3dc818f0d79b9472.js"],"component---wiki-spring-mock-timer-mdx":["/component---wiki-spring-mock-timer-mdx-09a3955d195df7795a43.js"],"component---wiki-tc-es-3-mdx":["/component---wiki-tc-es-3-mdx-aa6070fd457026e000bc.js"],"component---wiki-tc-ls-2-mdx":["/component---wiki-tc-ls-2-mdx-2b0c844efe4a4758fe99.js"],"component---wiki-stairstep-test-mdx":["/component---wiki-stairstep-test-mdx-54e43154228d2a9c5a64.js"],"component---wiki-tc-ls-2-branching-mdx":["/component---wiki-tc-ls-2-branching-mdx-1b5d1424241f1dbf8553.js"],"component---wiki-tc-ls-2-release-mdx":["/component---wiki-tc-ls-2-release-mdx-2720e2311fc319d8ff5d.js"],"component---wiki-teaching-mdx":["/component---wiki-teaching-mdx-f3175a3a8167569d9007.js"],"component---wiki-testing-mdx":["/component---wiki-testing-mdx-4ef10c2c978c69e077de.js"],"component---wiki-testing-guess-the-rule-mdx":["/component---wiki-testing-guess-the-rule-mdx-31d41040287c83fedd0e.js"],"component---wiki-the-three-rules-of-tdd-mdx":["/component---wiki-the-three-rules-of-tdd-mdx-038c80c6eb95015a5191.js"],"component---wiki-the-three-stages-of-tdd-mdx":["/component---wiki-the-three-stages-of-tdd-mdx-2cb85342f1ccaca5779c.js"],"component---wiki-angular-js-components-es-2015-mdx":["/component---wiki-angular-js-components-es-2015-mdx-3e0115a7edf779a4579e.js"]};/*]]>*/</script><script src="/component---wiki-angular-js-ng-class-performance-large-objects-mdx-e0feddedec2ade1f8ee2.js" async=""></script><script src="/commons-11945abf3215f370db4b.js" async=""></script><script src="/app-21dd1ea63a06020918b0.js" async=""></script><script src="/styles-b06f65a10670feeb2a17.js" async=""></script><script src="/webpack-runtime-1521b60311164167c383.js" async=""></script></body></html>