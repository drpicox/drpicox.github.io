(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"/Ai1":function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));a("q1tI");var n=a("7ljp"),c=a("eC7B"),s=a("m8Tn"),o=a("8rN0"),i=a("qKvR"),b=/\/\/(?:.*\.)?([^.]+\.[^./]+)\//;function p(e){var t=e.children,a=e.pageContext,p=a.frontmatter.canonical;return Object(i.a)(s.a,a.frontmatter,Object(i.a)(n.a,{components:o},Object(i.a)(c.a,null,Object(i.a)(o.Container,null,Object(i.a)("h1",null,a.frontmatter.title),p&&Object(i.a)("p",{class:"small"},Object(i.a)("a",{href:p,target:"_blank",rel:"noopener noreferrer"},"This article was originally published"," ",function(e){var t=e.match(b);return t?"at "+t[1]:"here"}(p)," ⬈")),t))))}},AXJg:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return r}));var n=a("wx14"),c=a("zLVn"),s=(a("q1tI"),a("7ljp")),o=a("/Ai1"),i=(a("qKvR"),{}),b={_frontmatter:i},p=o.a;function r(e){var t=e.components,a=Object(c.a)(e,["components"]);return Object(s.b)(p,Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"It is great to suggest people write tests.\nIt is indeed a good idea, but it is not enough."),Object(s.b)("p",null,"Writing tests is hard.\nNot because it is difficult, but because of people.\nPeople think that tests are pointless and consequently a waste of time."),Object(s.b)("p",null,"There are terrible testing practices, many of them harmful.\nWorst practices occur when coders are forced to write tests\n(big companies, test-obsessed coders, quality policies).\nMany of them resulting from these practices are almost useless.\nThey are just copies of production code or very rigid tests.\nThese tests lack many of the expected properties of a test."),Object(s.b)("p",null,"What should we expect from testing?"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"«But: program testing can be a very effective way\nto show the presence of bugs,\nbut is hopelessly inadequate for\nshowing their absence.»"),Object(s.b)("p",{parentName:"blockquote"},"— Edsger W. Dijkstra, 1972")),Object(s.b)("p",null,"Tests objective is not creating a bugs free system.\nIt is an impossible task.\nTests cannot effectively achieve that.\nHowever, there are many other objectives which are valuable."),Object(s.b)("h3",null,"Main tests objective is to make legacy code disappear."),Object(s.b)("p",null,"Legacy code is any old unsupported code.\nMoreover, it is any code difficult to change\nbecause changing it may break our system.\nIt is that code that is too complex or too slow to update.\nIt is that code that anyone is afraid to change."),Object(s.b)("p",null,"The legacy code appears when we want to change or add some code,\nbut we cannot guarantee to do not break any functionality.\nIt can be because:"),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},"There are no tests for such functionality."),Object(s.b)("li",{parentName:"ol"},"We need to alter many tests significantly."),Object(s.b)("li",{parentName:"ol"},"We do not know all supported functionalities.")),Object(s.b)("p",null,"The first and second scenarios are the classic ones that we consider: there are lots of functionalities, and we do not have time to check each functionality manually. Adding more tests can solve these scenarios, but it is not that simple: tests are usually unit tests designed to check a set of functions —functions instead of functionalities— . Coders become obsessed in test every function, one by one, all possible cases, all input combinations, all ranges. They try to get the 100% code coverage regardless of its usefulness. All this effort reaches one single conclusion: rigid codes poorly covered."),Object(s.b)("p",null,"The third scenario has a subtle difference: we cannot ensure all functionalities because we do not know which are the expected functionalities. This third scenario happens more often than we usually consider. Proper documentation would solve this scenario, but it has a handicap: documentation does not evolve with the code. Eventually, inevitably, documentation and code differ making the documentation obsolete."),Object(s.b)("p",null,"Here good news comes. There is a simple trick to solve these two scenarios and avoid legacy code: “",Object(s.b)("strong",{parentName:"p"},"testing is documentation"),".”"),Object(s.b)("p",null,"Let’s assume that tests are the documentation. As documentation they explain all the expected functionalities —functionalities instead of functions— , they describe what the code does, and they describe what we expect from them. We can understand and learn from it. As tests, they do not become obsolete. If something changes, tests fail, and update must happen."),Object(s.b)("h3",null,"An event listener testing example."),Object(s.b)("p",null,"Imagine that we want to implement an event listener. Also, imagine that we make some tests that cover 100% of the code:"),Object(s.b)("div",{className:"gatsby-highlight","data-language":"javascript"},Object(s.b)("pre",Object(n.a)({parentName:"div"},{className:"language-javascript"}),Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"describe"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'addListener'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"it"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'should add a callback to the queue'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"addListener"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"expect"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"_queue",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"toContain"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"describe"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'deliver'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"it"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'should invoke queue callbacks with the received argument'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," \n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"_queue",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"push"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"deliver"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'message'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"expect"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"toHaveBeenCalledWith"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'message'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")))),Object(s.b)("p",null,"These tests achieve 100% of code coverage, and at the same time, it is almost a useless testing code. Moreover, suppressing expectations in both tests, or replacing them by checking anything else —like checking that both methods return undefined— , they still achieve 100% of code coverage."),Object(s.b)("p",null,"These tests are checking something called “dispatcher.” Tests tell almost nothing about the purpose of the dispatcher. They are small pieces put apart and no explanation for how they work together. There is no whole picture. Adding more tests —cases like explaining what happens if the queue is empty— , do not provide for more insights about what dispatcher does."),Object(s.b)("p",null,"These tests also expose some data structures that meant to be internal or private —_queue in this case— . We should not use them in production code; therefore we should not use them in tests. Because we are exposing internal representation in tests, it is almost an impossible task refactor the code without changing the testing code."),Object(s.b)("p",null,"Stop. Take a breath. Clear your mind. Forget about the previous testing code example. Think about the dispatcher. What is the purpose of the dispatcher? What is it meant to do?"),Object(s.b)("p",null,"A dispatcher is an object that delivers messages to listeners. When we want to receive a message we add a listener —which is callback function— . Use the method send to notify all listeners of a payload. After the send method, dispatcher invokes all listeners with the payload as an argument."),Object(s.b)("p",null,"That was the documentation of the dispatcher. We should write tests just like that documentation:"),Object(s.b)("div",{className:"gatsby-highlight","data-language":"javascript"},Object(s.b)("pre",Object(n.a)({parentName:"div"},{className:"language-javascript"}),Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"it"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'delivers messages to listeners'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"addListener"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n  dispatcher",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"deliver"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'message'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"expect"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cb",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"toHaveBeenCalledWith"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'message'"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")))),Object(s.b)("p",null,"It is simple, clean, easy to understand, it does not use internal representation, and it has 100% of code coverage. If we refactor the dispatcher, as long as the functionality and API are valid, there is no need to change tests. If we want to start using the dispatcher, we make a copy and paste to our new production code. That last point makes these test excellent documentation: they are working examples of usage."),Object(s.b)("h3",null,"Conclusion."),Object(s.b)("p",null,"Tests are documentation. We should write them as they were the documentation. Working with tests as they were documentation they create better and more effective testing code. It helps to start writing useful tests and start with TDD. They give a direction to follow."),Object(s.b)("p",null,"When we are coding tests we should satisfy the following rules:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Start writing a test for each main functionality."),Object(s.b)("li",{parentName:"ul"},"Then their exceptions."),Object(s.b)("li",{parentName:"ul"},"Refactor tests until they are easy to read and understand."),Object(s.b)("li",{parentName:"ul"},"Never use “private” properties in testing code."),Object(s.b)("li",{parentName:"ul"},"Verify that testing code should be copy-pasteable to new production code."),Object(s.b)("li",{parentName:"ul"},"If some functionality works but has no test, do not use it."),Object(s.b)("li",{parentName:"ul"},"Test functionalities, not functions/methods."),Object(s.b)("li",{parentName:"ul"},"Tests should explain what the code does.")),Object(s.b)("p",null,"Anything else to read? You might be interested in reading:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"https://medium.com/@drpicox/the-myth-of-100-of-code-coverage-8d465589a0f8",target:"_blank",rel:"nofollow noopener noreferrer"}),"The myth of the 100% code coverage")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"https://medium.com/@drpicox/simple-exercise-to-understand-testing-and-refactoring-9b3431afd333",target:"_blank",rel:"nofollow noopener noreferrer"}),"A quick puzzle to understand testing and refactor"))))}r.isMDXComponent=!0}}]);
//# sourceMappingURL=component---blog-2018-02-09-why-you-should-start-writing-tests-as-they-were-documentation-mdx-cc07b88b6991aa4a1e8c.js.map