(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{WHYo:function(e,a,t){"use strict";t.d(a,"a",(function(){return u}));var n=t("q1tI"),c=t.n(n),s=t("7ljp"),o=t("eC7B"),b=t("qKvR"),p=t("8rN0");var m={name:"1dj59mw",styles:"margin-bottom:-4.5em;.prev{margin-right:0.3em;}.next{margin-left:0.3em;}"};function r(e){var a=e.index,t=e.prev,n=e.next;return Object(b.a)(c.a.Fragment,null,a&&Object(b.a)("div",{css:m},t&&Object(b.a)(p.Link,{className:"prev",to:"/"+t},"«"),Object(b.a)(p.Link,{className:"index",to:"/"+a},a),n&&Object(b.a)(p.Link,{className:"next",to:"/"+n},"»")))}var j={name:"ix6qzk",styles:'display:grid;grid-template-areas:"prev index next";grid-gap:0.5em;.prev{grid-area:prev;text-align:left;}.next{grid-area:next;text-align:right;}.index{grid-area:index;text-align:center;}'};function O(e){var a=e.prev,t=e.next,n=e.index;return n===a?Object(b.a)("div",{css:j},n&&Object(b.a)(p.Link,{className:"prev",to:"/"+n},"← Index"),t&&Object(b.a)(p.Link,{className:"next",to:"/"+t},t.replace(n,"")," →")):Object(b.a)("div",{css:j},n&&Object(b.a)(p.Link,{className:"index",to:"/"+n},n),a&&Object(b.a)(p.Link,{className:"prev",to:"/"+a},"← ",a.replace(n,"")),t&&Object(b.a)(p.Link,{className:"next",to:"/"+t},t.replace(n,"")," →"))}var N=t("m8Tn");function u(e){var a=e.children,t=e.pageContext.frontmatter,n=t.title,c=t.index,m=t.prev,j=t.next;return Object(b.a)(N.a,{title:n},Object(b.a)(s.a,{components:p},Object(b.a)(o.a,null,Object(b.a)(p.Container,null,Object(b.a)(r,{index:c,prev:m,next:j}),n&&Object(b.a)("h1",null,n),a,Object(b.a)(O,{index:c,prev:m,next:j})))))}},nCp1:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return b})),t.d(a,"default",(function(){return r}));var n=t("wx14"),c=t("zLVn"),s=(t("q1tI"),t("7ljp")),o=t("WHYo"),b=(t("qKvR"),{}),p={_frontmatter:b},m=o.a;function r(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(s.b)(m,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(s.b)("p",null,"RAFT is a consensus algorithm implementation\nthat synchonizes the state\nwith full consistency between\nmultiple servers with fault tolerance."),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"website"),": ",Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"https://raft.github.io/raft.pdf",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://raft.github.io/raft.pdf")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"source"),": ",Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/drpicox/uoc-raft-2013p",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://github.com/drpicox/uoc-raft-2013p"))),Object(s.b)("p",null,"In 2013 I teach the distributed systems laboratory of the\nUOC (Open University of Catalonia)."),Object(s.b)("p",null,"That year the assignation to the students was the implementation of the RAFT\nConsensus Algorithm and validation."),Object(s.b)("p",null,"This project contains the reference implementation used to compare against\nstudents results and give back as solution."),Object(s.b)("p",null,"To make thins easier for students (it is a 3 months assignment),\nsome hints about the implementation were given (to simplify it):"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Make timeouts always on: although it is not as efficient as fire timeouts only when needed, it helps to make code more stable and avoid some frequent race condition.")),Object(s.b)("div",{className:"gatsby-highlight","data-language":"java"},Object(s.b)("pre",Object(n.a)({parentName:"div"},{className:"language-java"}),Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"private")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"TimerTask")," electionTimeoutTask ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"TimerTask"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token annotation punctuation"}),"@Override"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"public")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"void")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"run"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"electionTimeout"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";")))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Copy current thread required state inside a guard zone: java programmers usually makes the whole method synchronized when they are trying to avoid problems in concurrent data structure concurrent accesses. This strategy is not always valid. Synchronized methods are in fact monitors and programmers only know about mutexes and semaphores, which causes some times unexpected results (for the programmer). In addition it also creates large zones of mutual exclusion, which reduces the performance. I suggested to the students to do the following schema: open a guard, copy the required state, close the guard, perform the operation with the required state, and, if results have to been saved, open again the guard, check everything, and store results. This schema is very beneficial when results are returned asynchronously, because everything still works and is more clear.")),Object(s.b)("div",{className:"gatsby-highlight","data-language":"java"},Object(s.b)("pre",Object(n.a)({parentName:"div"},{className:"language-java"}),Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"final")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"long")," term",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"final")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"String")," candidateId ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," localHost",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getId"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"final")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"int")," lastLogIndex",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"final")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"long")," lastLogTerm",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"synchronized")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"GUARD",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Leaders are free of election timeouts"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"state ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"==")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RaftState"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"LEADER",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," \n    \n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// So here only FOLLOWER and CANDIDATE"),"\n    term ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getCurrentTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"+")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"1"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    lastLogIndex ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getLastLogIndex"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    lastLogTerm ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getLastLogTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// And I'm now officially a CANDIDATE"),"\n    persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setCurrentTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"term",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setVotedFor"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"candidateId",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    state ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RaftState"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"CANDIDATE",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Use an executor queue and anonymous classes to deal with asynchronous results: I have to admit that I copied this idea from Javascript philosophy, but it worked incredible well. All previous implementation using reception handlers for each result were really messy, difficult to debug, and full of bugs and unexpected race conditions. Copying the Javascript philosophy I got a very easy way to implement and understand asynchronous operations:")),Object(s.b)("div",{className:"gatsby-highlight","data-language":"java"},Object(s.b)("pre",Object(n.a)({parentName:"div"},{className:"language-java"}),Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// request votes"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"for")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"final")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Host")," otherHost ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," otherServers",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    executorQueue",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"execute"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Runnable"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token annotation punctuation"}),"@Override"),"\n        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"public")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"void")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"run"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RequestVoteResponse")," response ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RMIsd"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getInstance"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"requestVote"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"otherHost",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," term",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," candidateId",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," lastLogIndex",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," lastLogTerm",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// not now or not me"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"response",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!=")," term ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"||")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"response",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"isVoteGranted"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"checkReceivedTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"term",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\t\t\t\t\t\t\t\n                ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// who wons?"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"int")," votes ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," voteCount",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"incrementAndGet"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";")," \n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"votes ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"==")," minimumVoteCount",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// I'm a winer??? (with less votes not yet, with more I'm already a leader)"),"\n                ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"synchronized")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"GUARD",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getCurrentTerm"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!=")," term ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"||")," state ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RaftState"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"CANDIDATE",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Ops! Something changed while network RPC go and come"),"\n                        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// I'm the leader"),"\n                    state ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"RaftState"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"LEADER",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n                    \n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Reset nextIndex and matchIndex"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"int")," nextIndex ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," persistentState",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getLastLogIndex"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"+")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"1"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"for")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Host")," otherHost ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," otherServers",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n                        nextIndexes",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"put"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"otherHost",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," nextIndex",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n                        matchIndexes",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"put"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"otherHost",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"0"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n                    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n                ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n            ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// else greater values ignored to avoid become leader to often"),"\n        ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")))))}r.isMDXComponent=!0}}]);
//# sourceMappingURL=component---wiki-raft-implementation-mdx-767c578da1e82b68e947.js.map