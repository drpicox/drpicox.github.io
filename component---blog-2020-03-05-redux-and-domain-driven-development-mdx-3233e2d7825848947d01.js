(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"/Ai1":function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));a("Ll4R"),a("q1tI");var n=a("7ljp"),s=a("eC7B"),o=a("m8Tn"),c=a("8rN0"),r=a("qKvR"),i=/\/\/(?:.*\.)?([^.]+\.[^./]+)\//;function p(e){var t=e.children,a=e.pageContext,p=a.frontmatter.canonical;return Object(r.a)(o.a,a.frontmatter,Object(r.a)(n.a,{components:c},Object(r.a)(s.a,null,Object(r.a)(c.Container,null,Object(r.a)("h1",null,a.frontmatter.title),p&&Object(r.a)("p",{class:"small"},Object(r.a)("a",{href:p,target:"_blank",rel:"noopener noreferrer"},"This article was originally published"," ",function(e){var t=e.match(i);return t?"at "+t[1]:"here"}(p)," ⬈")),t))))}},qt91:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return c})),a.d(t,"default",(function(){return p}));a("E5k/"),a("rzGZ"),a("Dq+y"),a("8npG"),a("Ggvi"),a("q1tI");var n=a("7ljp"),s=a("/Ai1");a("qKvR");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var c={},r={_frontmatter:c},i=s.a;function p(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,["components"]);return Object(n.b)(i,o({},r,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)("p",null,Object(n.b)("em",{parentName:"p"},"Dan Abramov, the creator of Redux, says that he does not know what Domain-Driven Design is. Still, it is impressive how Redux resembles DDD. In this article, I explain what DDD, some key concepts, and how Redux implements its ideas. Understanding both, we can deliver even better implementations; two approaches from different worlds that collide and take advantage of the same design principles.")),Object(n.b)("blockquote",{className:"twitter-tweet"},Object(n.b)("p",{lang:"en",dir:"ltr"},"Alas, I don’t know DDD. Can you show code examples of either approach? Generally you want to treat state as a database."),"— Dan Abramov (@dan_abramov) ",Object(n.b)("a",{href:"https://twitter.com/dan_abramov/status/731102007034040322?ref_src=twsrc%5Etfw"},"May 13, 2016"))," ",Object(n.b)("script",{async:!0,src:"https://platform.twitter.com/widgets.js",charSet:"utf-8"}),Object(n.b)("h2",null,"Domain-Driven Design"),Object(n.b)("p",null,"Domain-Driven Design is a software modeling technique designed to create robust microservices architectures as well as integrate multiple existing solutions."),Object(n.b)("p",null,"Eric Evans initially presented it in 2003 in the book «",Object(n.b)("em",{parentName:"p"},"Domain-Driven Design: Tackling Complexity in the Heart of Software."),"» Currently, DDD has many more books, more examples, and it has proved to be effective scaling and maintaining high-grade performance in large systems. If you have listened about Event-Sourcing or CQRS, then you have crossed your paths with DDD."),Object(n.b)("p",null,"We can split DDD into two areas: strategy and tactics. The strategy introduces the Ubiquitous Language and Bounded Context. It creates a common language between the developers and the business, but this language goes beyond meetings: all documentation, stories, and even code shares that language. You should never declare a variable with a name not included in the Ubiquitous Language."),Object(n.b)("p",null,"The tactics are more about how to implement the system. The main target is to enable a system that can scale distributed across many microservices in many locations. The main abstractions used are queries, commands, domain events, and aggregates. The application directs queries and commands towards the aggregates that can manage them, while domain events maintain eventual consistency in the whole system."),Object(n.b)("p",null,"The relevant concepts of the tactics are:"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Queries"),": Any question that you can do to the system that does not change its state. It is something that you ask for, and it responds with information. It should not involve any data change. Example of query: list the available posts."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/list-posts-query.png",alt:"listPosts(): list"})))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Commands"),": are requests for a mutation to the system. They may work, or they may fail. The system executes them and returns the result. Some variants, like CQS, do not allow commands to return a value. Example of command: add a new post."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/add-post-command.png",alt:"AddPost(title, body)"})))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Domain Events"),": are the key to the methodology; they represent the effect of cause and effect, facts, something that had happened. Events cannot fail, cannot be canceled. Any component in the application can listen for any event; when it receives an event, it can update itself and generate new events as a consequence. They are used to achieve eventual consistency. Examples of domain events are: a new post is added, or it is five o’clock."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/post-added-event.png",alt:"PostAdded(postId, title, body)"})))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Aggregates"),": it is the main pattern of the DDD. It represents small pieces of models (ideally just one entity and few object values) that are reasonably isolated. It communicates with other entities through queries, commands, and domain events. It consumes domain events to keep its state consistent with other parts of the system, and at the same time, it generates new domain events for each mutation that it has. Example of aggregate: post."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/post-added-event-source.png",alt:"Post(postId, title, body)"})))),Object(n.b)("p",null,"About Commands and Domain Events, unfortunately, many people confuse them, although they are very different. Commands are intentions and Domain Events are facts."),Object(n.b)("p",null,"If you want to learn more about DDD, I strongly recommend reading the book of Vernon Vaughn «Domain-Driven Design Distilled» (2016). This book quickly introduces all concepts and gives an unobstructed comprehensive view of how to start doing DDD."),Object(n.b)("h2",null,"Redux"),Object(n.b)("p",null,"Redux is shockingly related to Domain-Driven Design. Although it does not share the same terminology, the ideas are present. Redux is almost an implementation of the tactics of DDD in a functional paradigm."),Object(n.b)("p",null,"Let’s compare the previous concepts with Redux:"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Queries"),": they are selectors. Use a selector to obtain a piece of information from the state."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Commands"),": they are actions. When we dispatch an action, we submit a new command. Redux does not provide a result because it implements a pure CQS."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Events"),": they are actions, too. But, ¿when an action is a fact? After when it is reduced. After reducing an action, it becomes a fact, something that does not change."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Aggregate"),": the aggregate is who computes all changes in the state; this is the reducer."),Object(n.b)("p",null,"Unfortunately, Redux vocabulary does not make easy distinguish between commands and domain events. DDD uses infinitive verbs to denote commands and events in the past participle. Although it is common to see action types like “FETCH_POST” or “FETCH_POST_SUCCESSFUL.”"),Object(n.b)("h2",null,"DDD Patterns on Redux"),Object(n.b)("p",null,"Two patterns have made DDD popular: Event Sourcing and CQRS. Both have born from the necessity to improve scalability and performance, and both techniques are usually applied in Redux."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"The first is Event Sourcing"),". The objective of DDD for event sourcing is to increase the throughput of writes in a database. Instead of saving each change in the database, it only stores the domain events emitted by each aggregate and when it is possible a snapshot of the aggregate. The reasoning is simple: you can reconstruct the state of any aggregate by replaying its events. "),Object(n.b)("p",null,"For example, you can reconstruct the application posts by replaying all PostAdded events."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/post-added-event-source.png",alt:"event sourcing"})))),Object(n.b)("p",null,"Are you familiar with this concept in Redux? Almost sure, yes. In Redux, this is called Time Traveling, and probably you have used it many times in the developer tools."),Object(n.b)("p",null,"And this pattern is great; it does not only allows us to fix bugs more quickly, or speed writes on servers, but it helps to make the application safer. Data corruption? No problem, replay the events, and you can reconstruct the state, even if you had a bug. Are you helping other users? Just replay their events to know which is their state."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"The second is CQRS"),". The objective of DDD for CQRS is to create models that combine the data from multiple aggregates, so, instead of performing numerous slow queries, make one quick fast query on one single model. If Event Sourcing tackled slow updates, it addresses slow queries. The idea is that a unique model would consume multiple events and would compute a derived state, consistently. For example, we can create a model to count posts that uses PostAdded events to increment the count."),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/post-added-cqrs.png",alt:"event sourcing"})))),Object(n.b)("p",null,"The equivalent in Redux is when multiple reducers are updating the store in different places. Although we have selectors with memoization, some times, we prefer to keep computed derived data to boost performance. For example, when we have an object with entities indexed by keys, but we have an array with the keys so we can list them efficiently."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"The third is the decoupling that has DDD"),". One of the main strengths, beyond the scalability in performance, it is the maintainability of the code. The concept of aggregate and how it interacts with others it gives excellent implementations."),Object(n.b)("p",null,"Let’s see an example: we have a company that sells products and uses marketing campaigns to make offers. Existing units in shops are labeled initially by their corresponding product selling price, but when the campaign starts, it relabels units with the advertised price."),Object(n.b)("p",null,"Without DDD we have a code like the following:"),Object(n.b)("center",{style:{background:"rgba(255,255,255,0.5)"}},Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/campaign-product-unit.png",alt:"campaign - product - unit"})))),Object(n.b)("div",{className:"gatsby-highlight","data-language":"javascript"},Object(n.b)("pre",o({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",o({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",o({parentName:"code"},{className:"token comment"}),"// Without DDD"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"class")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"Campaign")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"startCampaign"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    product",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"relabelUnits"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"advertisedPrice",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"class")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"Product")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"relabelUnits"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token parameter"}),"price"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    units",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"forEach"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token parameter"}),"unit")," ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"=>")," unit",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"relabelPrice"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"price",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"class")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"Unit")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"relabelPrice"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token parameter"}),"price"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    labeledPrice ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," price",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")))),Object(n.b)("p",null,"If we apply DDD we can relay on domain events to update other aggregates:"),Object(n.b)("center",null,Object(n.b)("p",null,Object(n.b)("img",o({parentName:"p"},{src:"/images/ddd/campaign-event-unit.png",alt:"campaign - product - unit"})))),Object(n.b)("div",{className:"gatsby-highlight","data-language":"javascript"},Object(n.b)("pre",o({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",o({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",o({parentName:"code"},{className:"token comment"}),"// With DDD"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"class")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"Campaign")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"startCampaign"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"emit"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"new")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"CampaignStarted"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," productId",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," advertisedPrice",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"class")," ",Object(n.b)("span",o({parentName:"code"},{className:"token class-name"}),"Unit")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"onCampaignStarted"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token parameter"}),"event"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    labeledPrice ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," event",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"advertisedPrice",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")))),Object(n.b)("p",null,"Did you have noticed the difference? Now Product has disappeared. The Product does not depend anymore from the Unit. We have reduced the coupling of the application, and we can plug and unplug the units from our application without changing any code."),Object(n.b)("p",null,"Redux does the same decoupling. Each combined reducer is like one aggregate. When a reducer receives one action, it reduces it independently."),Object(n.b)("div",{className:"gatsby-highlight","data-language":"javascript"},Object(n.b)("pre",o({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",o({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"function")," ",Object(n.b)("span",o({parentName:"code"},{className:"token function"}),"reduceUnit"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",o({parentName:"code"},{className:"token parameter"}),"state",Object(n.b)("span",o({parentName:"span"},{className:"token punctuation"}),",")," action"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"switch")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"action",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"type",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"case")," ",Object(n.b)("span",o({parentName:"code"},{className:"token constant"}),"START_CAMPAIGN"),Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),":"),"\n      ",Object(n.b)("span",o({parentName:"code"},{className:"token keyword"}),"return")," ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"state",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," labeledPrice",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),":")," action",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"advertisedPrice ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(n.b)("span",o({parentName:"code"},{className:"token operator"}),"..."),"\n  ",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")))),Object(n.b)("h2",null,"Conclusion"),Object(n.b)("p",null,"Redux and DDD present many similarities, and both share many of the advantages. Although they are created from different abstractions and from different backgrounds, both benefit the same architectural principles."),Object(n.b)("p",null,"The main difference is the domain events. This concept does not exist clearly in Redux. It has consequences, and it will probably be studied in further articles."))}p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---blog-2020-03-05-redux-and-domain-driven-development-mdx-3233e2d7825848947d01.js.map